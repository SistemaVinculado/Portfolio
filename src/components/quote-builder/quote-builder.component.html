<section class="py-16 sm:py-24 bg-black">
  <div class="max-w-7xl mx-auto px-6 sm:px-8 lg:px-12">
    <div class="max-w-4xl mx-auto text-center">
      <h2 class="text-4xl sm:text-5xl font-bold tracking-tight" appAnimateOnScroll appShimmerText [alternateText]="'Configure seu Projeto Técnico'">Configure seu Projeto Fundamental</h2>
      <p class="mt-4 text-lg text-gray-400" appAnimateOnScroll [animationDelay]="'100ms'">
        Selecione a tecnologia fundamental, configure as funcionalidades essenciais e defina seu orçamento para uma estimativa precisa. Este é o primeiro passo para uma colaboração de prestígio.
      </p>
    </div>

    <div class="mt-16" appAnimateOnScroll [animationDelay]="'200ms'">
      <div class="relative flex items-center justify-center flex-wrap gap-2 p-1 bg-[#111111] rounded-full w-fit mx-auto border border-gray-800">
        <!-- Sliding Highlight -->
        <div 
          class="absolute top-1 bottom-1 left-0 rounded-full transition-all duration-300 ease-out"
          [style]="highlightStyle()"
          [style.background-color]="activeGlowColor()">
        </div>

        <!-- Buttons -->
        <button 
          #angularBtn
          (click)="setActiveTab('angular')"
          [class.text-white]="activeTab() === 'angular'"
          [class.text-gray-300]="activeTab() !== 'angular'"
          class="relative z-10 flex items-center px-4 sm:px-5 py-2 sm:py-2.5 text-base sm:text-lg font-semibold transition-colors duration-300 hover:text-white focus:outline-none">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2 shrink-0 transition-colors duration-300" [style.color]="activeTab() === 'angular' ? 'white' : '#ef4444'">
              <path d="M12 2L4 5L5 18L12 22L19 18L20 5L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M16 8L12 17L8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M9.5 13H14.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          <span>Angular</span>
        </button>
        <button 
          #reactBtn
          (click)="setActiveTab('react')"
          [class.text-white]="activeTab() === 'react'"
          [class.text-gray-300]="activeTab() !== 'react'"
          class="relative z-10 flex items-center px-4 sm:px-5 py-2 sm:py-2.5 text-base sm:text-lg font-semibold transition-colors duration-300 hover:text-white focus:outline-none">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2 shrink-0 transition-colors duration-300" [style.color]="activeTab() === 'react' ? 'white' : '#3b82f6'">
              <circle cx="12" cy="12" r="2" stroke="currentColor" stroke-width="2"/>
              <ellipse cx="12" cy="12" rx="10" ry="4" transform="rotate(45 12 12)" stroke="currentColor" stroke-width="2"/>
              <ellipse cx="12" cy="12" rx="10" ry="4" transform="rotate(-45 12 12)" stroke="currentColor" stroke-width="2"/>
            </svg>
          <span>React</span>
        </button>
        <button 
          #backendBtn
          (click)="setActiveTab('backend')"
          [class.text-white]="activeTab() === 'backend'"
          [class.text-gray-300]="activeTab() !== 'backend'"
          class="relative z-10 flex items-center px-4 sm:px-5 py-2 sm:py-2.5 text-base sm:text-lg font-semibold transition-colors duration-300 hover:text-white focus:outline-none">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2 shrink-0 transition-colors duration-300" [style.color]="activeTab() === 'backend' ? 'white' : '#a855f7'">
              <ellipse cx="12" cy="5" rx="9" ry="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 12c0 1.66-4.03 3-9 3s-9-1.34-9-3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          <span>Backend</span>
        </button>
        <button 
          #infraBtn
          (click)="setActiveTab('infrastructure')"
          [class.text-white]="activeTab() === 'infrastructure'"
          [class.text-gray-300]="activeTab() !== 'infrastructure'"
          class="relative z-10 flex items-center px-4 sm:px-5 py-2 sm:py-2.5 text-base sm:text-lg font-semibold transition-colors duration-300 hover:text-white focus:outline-none">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2 shrink-0 transition-colors duration-300" [style.color]="activeTab() === 'infrastructure' ? 'white' : '#22c55e'" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.65H8.228a3.375 3.375 0 0 0-3.285 2.65l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m15.54 0a2.25 2.25 0 0 1-2.25 2.25h-10.5a2.25 2.25 0 0 1-2.25-2.25m15.54 0v-1.178c0-1.517-1.232-2.75-2.75-2.75h-10.5c-1.518 0-2.75 1.233-2.75 2.75v1.178m15.54 0h-15.54Z" />
            </svg>
          <span>Infraestrutura</span>
        </button>
        <button 
          #customBtn
          (click)="setActiveTab('custom')"
          [class.text-white]="activeTab() === 'custom'"
          [class.text-gray-300]="activeTab() !== 'custom'"
          class="relative z-10 flex items-center px-4 sm:px-5 py-2 sm:py-2.5 text-base sm:text-lg font-semibold transition-colors duration-300 hover:text-white focus:outline-none">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2 shrink-0 transition-colors duration-300" [style.color]="activeTab() === 'custom' ? 'white' : '#f59e0b'" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.572L16.25 22l-.648-1.428a2.25 2.25 0 01-1.482-1.482L12.75 18l1.428-.648a2.25 2.25 0 011.482-1.482L16.25 14l.648 1.428a2.25 2.25 0 011.482 1.482L19.75 18l-1.428.648a2.25 2.25 0 01-1.482 1.482z" />
            </svg>
          <span>Personalizado</span>
        </button>
      </div>
    </div>

    <div class="mt-12 grid lg:grid-cols-3 gap-16">
      <!-- Left Column: Content -->
      @if (activeTab() !== 'custom') {
        <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
          @for(feature of activeFeatures(); track feature.id; let i = $index) {
            <div 
              class="animate-card-fade-in relative group bg-charcoal-light/60 backdrop-blur-md rounded-2xl border border-gray-800 transition-all duration-300 flex flex-col"
              [class.!border-green-500]="selectedFeatures().has(feature.id)"
              [style.animation-delay]="i * 100 + 250 + 'ms'"
              style="opacity: 0;">
              
              <div (click)="toggleFeature(feature.id)" class="p-6 cursor-pointer hover:bg-white/5 rounded-t-2xl transition-colors duration-300">
                <div 
                  class="absolute top-5 right-5 h-6 w-6 rounded-full border-2 transition-all duration-300 flex items-center justify-center"
                  [class.bg-green-500]="selectedFeatures().has(feature.id)"
                  [class.border-gray-600]="!selectedFeatures().has(feature.id)"
                  [class.group-hover:border-gray-400]="!selectedFeatures().has(feature.id)"
                  [class.border-green-500]="selectedFeatures().has(feature.id)">
                  @if(selectedFeatures().has(feature.id)) {
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-black" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                    </svg>
                  }
                </div>

                <div class="flex items-start gap-4">
                  <div class="text-gray-500 transition-colors duration-300" 
                      [class.text-green-400]="selectedFeatures().has(feature.id)">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 flex-shrink-0" [innerHTML]="feature.iconSvg"></svg>
                  </div>
                  <div>
                    <h3 class="text-xl font-semibold text-white">{{ feature.name }}</h3>
                    <p class="text-gray-400 mt-1">{{ feature.description }}</p>
                    <p class="text-lg font-medium text-green-400 mt-3">
                      + R$ {{ feature.price.toLocaleString('pt-BR') }}
                    </p>
                  </div>
                </div>
              </div>

              <!-- Collapsible Section for Options -->
              @if(feature.options && feature.options.length > 0) {
                <div class="overflow-hidden transition-[max-height] duration-500 ease-in-out"
                     [class.max-h-0]="!selectedFeatures().has(feature.id)"
                     [class.max-h-[500px]]="selectedFeatures().has(feature.id)">
                  <div class="px-6 pb-6 pt-4 border-t border-gray-700">
                    <h4 class="text-base font-semibold text-gray-300 mb-3">Funcionalidades Adicionais</h4>
                    <div class="space-y-2">
                      @for(option of feature.options; track option.id) {
                        <label class="flex items-center p-3 rounded-lg hover:bg-white/5 transition-colors duration-200 cursor-pointer">
                          <input 
                            type="checkbox"
                            class="h-5 w-5 rounded bg-charcoal border-gray-600 text-green-500 focus:ring-green-500/50 focus:ring-offset-charcoal-light"
                            [checked]="selectedOptions().has(option.id)"
                            (change)="toggleOption(option.id); $event.stopPropagation()">
                          <span class="ml-3 text-gray-300 flex-grow">{{ option.name }}</span>
                          <span class="text-gray-400 font-medium">+ R$ {{ option.price.toLocaleString('pt-BR') }}</span>
                        </label>
                      }
                    </div>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      } @else {
        <div class="lg:col-span-2 animate-card-fade-in" style="animation-delay: 250ms; opacity: 0;">
          <div class="bg-charcoal-light/60 backdrop-blur-md rounded-2xl border border-gray-800 p-8 h-full">
            <h3 class="text-2xl font-bold text-white mb-2">Seu Projeto. Suas Regras.</h3>
            <p class="text-gray-400 mb-6">Descreva sua visão, uma funcionalidade específica ou um projeto que não se encaixa nas categorias. Estou pronto para arquitetar uma solução sob medida.</p>
            <div class="relative group">
                <textarea 
                  id="custom-idea"
                  [formControl]="customProjectControl"
                  rows="10"
                  placeholder=" "
                  class="peer w-full bg-[#111111] border border-gray-700 rounded-lg p-4 pt-8 focus:ring-2 focus:ring-amber-500/50 focus:outline-none transition-shadow text-white resize-y"></textarea>
                <label 
                    for="custom-idea"
                    class="absolute top-5 left-4 text-gray-400 transition-all duration-300 transform origin-[0] pointer-events-none
                          peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 
                          peer-focus:scale-75 peer-focus:-translate-y-4
                          scale-75 -translate-y-4">
                    Descreva sua ideia de projeto aqui...
                </label>
            </div>
             @if (customProjectControl.invalid && customProjectControl.touched) {
              <p class="text-red-400 text-sm mt-2">Por favor, descreva sua ideia (pelo menos 20 caracteres).</p>
            }
          </div>
        </div>
      }

      <!-- Right Column: Summary Panel -->
      <div class="lg:col-span-1" appAnimateOnScroll [animationDelay]="'400ms'">
        <div class="sticky top-28 bg-charcoal-light rounded-2xl border border-gray-800 p-8">
          <h3 class="text-2xl font-bold text-white">Resumo do Orçamento</h3>
          <div class="mt-8 space-y-6">
            <div>
              <div class="flex justify-between items-baseline">
                <label for="target-budget" class="text-lg font-medium text-gray-300">Seu Orçamento Alvo</label>
                <span class="text-xl font-bold text-white">R$ {{ targetBudget().toLocaleString('pt-BR') }}</span>
              </div>
              <input 
                id="target-budget"
                type="range" 
                min="50" 
                max="100000" 
                step="50" 
                [value]="targetBudget()" 
                (input)="onBudgetChange($event)"
                class="w-full mt-3">
            </div>

            @if (activeTab() !== 'custom') {
              <div class="border-t border-gray-700 pt-6">
                <div class="flex justify-between items-baseline">
                  @if (activeTab() === 'infrastructure') {
                    <span class="text-lg font-medium text-gray-300">Custo Anual Estimado</span>
                  } @else {
                    <span class="text-lg font-medium text-gray-300">Custo Total Estimado</span>
                  }
                  <span class="text-xl font-bold text-white">R$ {{ totalCost().toLocaleString('pt-BR') }}</span>
                </div>

                <div class="mt-4 flex justify-between items-baseline text-sm"
                    [class.text-green-400]="budgetDifference() >= 0"
                    [class.text-red-400]="budgetDifference() < 0">
                  @if (budgetDifference() >= 0) {
                    <span>Abaixo do orçamento por</span>
                    <span>R$ {{ absBudgetDifference().toLocaleString('pt-BR') }}</span>
                  } @else {
                    <span>Acima do orçamento por</span>
                    <span>R$ {{ absBudgetDifference().toLocaleString('pt-BR') }}</span>
                  }
                </div>
              </div>
            }
          </div>

          <div class="mt-8 border-t border-gray-700 pt-6">
            <button 
              (click)="generateBriefPrompt()"
              [disabled]="(activeTab() === 'custom' && customProjectControl.invalid) || (activeTab() !== 'custom' && activeTab() !== 'infrastructure' && selectedFeatures().size === 0)"
              class="w-full bg-white text-black rounded-full px-8 py-4 text-lg font-semibold btn-fancy disabled:bg-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed">
                <span class="btn-content inline-flex items-center gap-3">
                  Gerar Briefing Estratégico
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm9.5 4a.5.5 0 00-.5-.5h-2a.5.5 0 000 1h2a.5.5 0 00.5-.5zM5.5 9a.5.5 0 01.5-.5h5a.5.5 0 010 1h-5a.5.5 0 01-.5-.5zM5.5 12a.5.5 0 01.5-.5h5a.5.5 0 010 1h-5a.5.5 0 01-.5-.5z" /></svg>
                </span>
            </button>
            <p class="text-xs text-gray-500 mt-4 text-center">A IA analisará suas escolhas para estruturar um briefing estratégico inicial.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
