<section class="py-16 sm:py-24 bg-black overflow-hidden">
  <div class="max-w-7xl mx-auto px-6 sm:px-8 lg:px-12">
    <div class="max-w-4xl">
      <h2 class="text-4xl sm:text-5xl font-bold tracking-tight mb-16" appAnimateOnScroll appShimmerText [alternateText]="'Histórias de Sucesso de Clientes'">
        Parcerias de Prestígio
      </h2>
    </div>

    <div class="relative flex flex-col items-center justify-center min-h-[550px]" style="perspective: 1500px;">
      <!-- 3D Carousel Container -->
      <div class="relative w-full max-w-2xl h-[400px]" style="transform-style: preserve-3d;" appAnimateOnScroll [animationDelay]="'200ms'">
        @for(story of clientStories; track story.name; let i = $index) {
          <div 
            class="absolute inset-0"
            [style]="cardStyles()[i]">
            <div 
              #card
              appTiltOnHover
              class="relative w-full h-full bg-charcoal-light rounded-3xl border border-gray-800 p-8 flex items-center transition-transform duration-200 ease-out"
              style="transform-style: preserve-3d;">

              <!-- Background Glow -->
              <div class="absolute inset-0 rounded-3xl transition-all duration-700 ease-out" 
                   [style.background-image]="'radial-gradient(circle at 90% 10%, ' + story.themeColor + '1A, transparent 50%)'">
              </div>
              
              <div class="relative w-full">
                <p 
                  class="text-xs font-bold tracking-widest uppercase" 
                  [style.color]="story.themeColor">
                  {{ story.category }}
                </p>
                <p class="text-2xl lg:text-3xl text-gray-200 mt-6 font-light leading-snug">
                  "{{ story.description }}"
                </p>
                <div class="flex flex-wrap gap-2 mt-8">
                  @for (tag of story.tags; track tag) {
                    <span class="bg-gray-800 text-white/80 border border-gray-700 rounded-full px-3 py-1 text-xs font-semibold">
                      {{ tag }}
                    </span>
                  }
                </div>
                <div class="mt-8">
                  <button (click)="openModal(story)" class="font-semibold text-white inline-flex items-center justify-center sm:justify-start gap-2 group/link btn-fancy-green bg-transparent border border-green-500/50 hover:border-green-500 rounded-full px-6 py-3">
                    <span class="btn-content">
                      Explorar Colaboração
                      <svg xmlns="http://www.w3.org/2000/svg" class="inline-block h-5 w-5 ml-1 transition-transform duration-300 group-hover/link:translate-x-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        }
      </div>

      <!-- Navigation -->
      <div class="mt-8 flex items-center gap-4" appAnimateOnScroll [animationDelay]="'400ms'">
        <button (click)="prev()" aria-label="Anterior" class="w-14 h-14 flex items-center justify-center rounded-full border border-gray-700 text-gray-400 hover:bg-white/10 hover:text-white transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-white/50">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
          </svg>
        </button>
        <button (click)="next()" aria-label="Próximo" class="w-14 h-14 flex items-center justify-center rounded-full border border-gray-700 text-gray-400 hover:bg-white/10 hover:text-white transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-white/50">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
          </svg>
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Testimonial Modal -->
@if (selectedStory(); as story) {
  <div class="fixed inset-0 bg-black/80 z-[100] animate-modal-scale-in flex items-center justify-center p-4" (click)="closeModal()">
    <div class="bg-[#191919] rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col border border-gray-800" (click)="$event.stopPropagation()">
      
      <header class="flex justify-end items-center p-4 flex-shrink-0">
        <button (click)="closeModal()" class="text-gray-400 hover:text-white transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </header>

      <main class="px-8 pb-8 overflow-y-auto flex-grow">
        <div class="grid md:grid-cols-3 gap-8">
          <div class="md:col-span-1">
            <div class="bg-charcoal-light rounded-2xl p-6 h-64 flex flex-col justify-between overflow-hidden mb-6 border border-gray-800">
              <p class="text-xs font-bold text-white/70 tracking-widest uppercase text-right">{{ story.category }}</p>
              <div>
                <div class="text-6xl font-bold text-white">{{ story.name }}</div>
              </div>
            </div>
            <div class="flex flex-wrap gap-2">
              @for (tag of story.tags; track tag) {
                <span class="bg-gray-800 text-white border border-gray-700 rounded-full px-2.5 py-0.5 text-xs font-semibold">
                  {{ tag }}
                </span>
              }
            </div>
          </div>
          <div class="md:col-span-2">
            <h2 class="text-3xl font-bold text-white mb-4">Detalhes da Colaboração</h2>
            <p class="text-gray-300 leading-relaxed">
              {{ story.fullDescription }}
            </p>
          </div>
        </div>
      </main>

    </div>
  </div>
}